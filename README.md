# Version Stage Workflow

ä¸€ä¸ªå¯å¤ç”¨çš„ GitHub Actions å·¥ä½œæµèŠ‚ç‚¹ï¼Œä¸“é—¨ç”¨äº Web é¡¹ç›®çš„ç‰ˆæœ¬åŒ–å½’æ¡£å’Œç‰ˆæœ¬åˆ‡æ¢åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ·ï¸ **å¯å¤ç”¨å·¥ä½œæµ**ï¼šä½œä¸ºä¸‹çº§èŠ‚ç‚¹è¢«å…¶ä»–é¡¹ç›®è°ƒç”¨ï¼Œæ— éœ€å¤„ç†æ„å»ºè¿‡ç¨‹
- ğŸš€ **è‡ªåŠ¨ç‰ˆæœ¬å½’æ¡£**ï¼šå°†å·²æ„å»ºçš„äº§ç‰©æŒ‰ç‰ˆæœ¬å·å½’æ¡£åˆ°æŒ‡å®šåˆ†æ”¯
- ğŸ”— **URL è·¯å¾„åˆ‡æ¢**ï¼šæ¯ä¸ªç‰ˆæœ¬ç‹¬ç«‹ URLï¼ŒSEO å‹å¥½ï¼Œå¯ç›´æ¥åˆ†äº«
- ğŸ”„ **ç‰ˆæœ¬åˆ‡æ¢UI**ï¼šç¾è§‚çš„æ‚¬æµ®ç‰ˆæœ¬åˆ‡æ¢å™¨ï¼Œæ”¯æŒæœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸ“¦ **å¤šé¡¹ç›®æ”¯æŒ**ï¼šå¯è¢«ä¸åŒçš„ Web é¡¹ç›®å¤ç”¨ï¼Œå®Œå…¨å…¼å®¹ SSR æ¡†æ¶
- ğŸ” **æ™ºèƒ½æœç´¢**ï¼šæ”¯æŒç‰ˆæœ¬å·æ¨¡ç³Šæœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸŒ **GitHub Pagesé›†æˆ**ï¼šè‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pagesï¼ŒåŒ…å«è‡ªåŠ¨é‡å®šå‘
- âš¡ **é«˜æ€§èƒ½**ï¼šæ—  iframe å¼€é”€ï¼Œç›´æ¥ URL è·³è½¬ï¼Œæ”¯æŒæµè§ˆå™¨ç¼“å­˜

## è®¾è®¡ç†å¿µ

æ­¤å·¥ä½œæµä¸“é—¨è®¾è®¡ä¸º **ä¸‹çº§èŠ‚ç‚¹**ï¼Œä¸“æ³¨äºç‰ˆæœ¬å½’æ¡£åŠŸèƒ½ï¼š

- âœ… **æ¥æ”¶æ„å»ºäº§ç‰©**ï¼šä»è°ƒç”¨æ–¹è·å–å·²æ„å»ºçš„æ–‡ä»¶
- âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼šè‡ªåŠ¨æ£€æµ‹æˆ–æ¥æ”¶ç‰ˆæœ¬å·
- âœ… **å½’æ¡£å­˜å‚¨**ï¼šæŒ‰ç‰ˆæœ¬ç»„ç»‡å’Œå­˜å‚¨æ–‡ä»¶
- âœ… **UIæ³¨å…¥**ï¼šè‡ªåŠ¨æ·»åŠ ç‰ˆæœ¬åˆ‡æ¢åŠŸèƒ½
- âŒ **ä¸å¤„ç†æ„å»º**ï¼šä¸æ¶‰åŠä¾èµ–å®‰è£…ã€ç¼–è¯‘ç­‰æ„å»ºè¿‡ç¨‹

## å¿«é€Ÿå¼€å§‹

### 1. ç¡®ä¿é¡¹ç›®æœ‰ package.json

ç‰ˆæœ¬å·å°†è‡ªåŠ¨ä» `package.json` çš„ `version` å­—æ®µè·å–ï¼š

```json
{
  "name": "your-project",
  "version": "1.2.35",
  "scripts": {
    "build": "your-build-command"
  }
}
```

### 2. åœ¨æ‚¨çš„é¡¹ç›®ä¸­å¼•ç”¨

```yaml
# .github/workflows/deploy.yml
name: Build and Archive

on:
  push:
    branches: [ main ]  # æ¨é€åˆ°ä¸»åˆ†æ”¯æ—¶è§¦å‘
  workflow_dispatch:   # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'pnpm'
    
    # æ‚¨çš„æ„å»ºè¿‡ç¨‹
    - run: pnpm install
    - run: pnpm build
    
    # ä¸Šä¼ æ„å»ºäº§ç‰©
    - uses: actions/upload-artifact@v4
      with:
        name: build-artifacts
        path: dist/  # æ‚¨çš„æ„å»ºè¾“å‡ºç›®å½•

  # è°ƒç”¨ç‰ˆæœ¬å½’æ¡£å·¥ä½œæµ
  archive:
    needs: build
    uses: your-username/version-stage-workflow/.github/workflows/version-archive.yml@main
    with:
      build_dir: 'dist'  # æ‚¨çš„æ„å»ºè¾“å‡ºç›®å½•
```

### 3. æœ¬åœ°å¼€å‘æµ‹è¯•

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/version-stage-workflow.git
cd version-stage-workflow

# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºæµ‹è¯•é¡¹ç›®
cd test && node build.js && cd ..

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
# è®¿é—® http://localhost:3000/test/
```

## ç›®å½•ç»“æ„

```
version-stage-workflow/
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ version-archive.yml     # ä¸»å·¥ä½œæµæ–‡ä»¶
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ archive-version.js      # ç‰ˆæœ¬å½’æ¡£è„šæœ¬
â”‚   â”œâ”€â”€ update-version-index.js # ç‰ˆæœ¬ç´¢å¼•æ›´æ–°è„šæœ¬
â”‚   â”œâ”€â”€ build.js               # æ„å»ºè„šæœ¬
â”‚   â””â”€â”€ dev-server.js          # å¼€å‘æœåŠ¡å™¨
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ version-switcher.js    # ç‰ˆæœ¬åˆ‡æ¢å™¨è„šæœ¬
â”‚   â””â”€â”€ version-switcher.css   # ç‰ˆæœ¬åˆ‡æ¢å™¨æ ·å¼
â”œâ”€â”€ test/                      # æµ‹è¯•é¡¹ç›®
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ usage.md              # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â””â”€â”€ package.json
```

## é…ç½®å‚æ•°

| å‚æ•° | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `build_dir` | âœ… | `dist` | æ„å»ºäº§ç‰©ç›®å½• |
| `version` | âŒ | è‡ªåŠ¨æ£€æµ‹ | ç‰ˆæœ¬å· |
| `archive_branch` | âŒ | `gh-pages` | å½’æ¡£åˆ†æ”¯ |
| `force_archive` | âŒ | `false` | å¼ºåˆ¶è¦†ç›– |
| `enable_pages` | âŒ | `true` | éƒ¨ç½²åˆ° Pages |

## ç‰ˆæœ¬æ£€æµ‹è§„åˆ™

1. æ‰‹åŠ¨è¾“å…¥çš„ `version` å‚æ•°
2. Git æ ‡ç­¾ï¼ˆå¦‚æ¨é€ v1.0.0 æ ‡ç­¾ï¼‰
3. package.json ä¸­çš„ version å­—æ®µ
4. é»˜è®¤å€¼ v1.0.0

## ä½¿ç”¨æ•ˆæœ

å½’æ¡£å®Œæˆåï¼š
- ğŸ“ æ¯ä¸ªç‰ˆæœ¬ç‹¬ç«‹å­˜å‚¨åœ¨ `versions/1.0.0/` ç›®å½•
- ğŸ·ï¸ è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬åˆ‡æ¢å™¨UIï¼ˆå·¦ä¸Šè§’ï¼‰
- ğŸ” æ”¯æŒç‰ˆæœ¬æœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸŒ é€šè¿‡ GitHub Pages åœ¨çº¿è®¿é—®

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ğŸ“‚ æœ€ç»ˆéƒ¨ç½²ç»“æ„

```
GitHub Pages æ ¹ç›®å½•/
â”œâ”€â”€ index.html                    # ä¸»é¡µé¢ï¼ˆè‡ªåŠ¨é‡å®šå‘åˆ°æœ€æ–°ç‰ˆæœ¬ï¼‰
â”œâ”€â”€ versions.json                 # ç‰ˆæœ¬ç´¢å¼•æ–‡ä»¶
â”œâ”€â”€ version-switcher.js           # ç‰ˆæœ¬åˆ‡æ¢å™¨è„šæœ¬
â”œâ”€â”€ version-switcher.css          # ç‰ˆæœ¬åˆ‡æ¢å™¨æ ·å¼
â”œâ”€â”€ v1.0.0/                       # ç‰ˆæœ¬ 1.0.0
â”‚   â”œâ”€â”€ index.html                # å®Œæ•´çš„ç«™ç‚¹æ–‡ä»¶
â”‚   â”œâ”€â”€ assets/                   # èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ version-injector.js       # ç‰ˆæœ¬åˆ‡æ¢å™¨æ³¨å…¥è„šæœ¬
â””â”€â”€ v1.0.1/                       # ç‰ˆæœ¬ 1.0.1
    â”œâ”€â”€ index.html                # å®Œæ•´çš„ç«™ç‚¹æ–‡ä»¶
    â”œâ”€â”€ assets/                   # èµ„æºæ–‡ä»¶
    â””â”€â”€ version-injector.js       # ç‰ˆæœ¬åˆ‡æ¢å™¨æ³¨å…¥è„šæœ¬
```

### ğŸ”„ ç‰ˆæœ¬åˆ‡æ¢åŸç†

1. **ç‹¬ç«‹ URL**ï¼šæ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰ç‹¬ç«‹çš„ URL è·¯å¾„ï¼ˆå¦‚ `/v1.0.0/`ã€`/v1.0.1/`ï¼‰
2. **è‡ªåŠ¨é‡å®šå‘**ï¼šæ ¹ç›®å½•è‡ªåŠ¨é‡å®šå‘åˆ°æœ€æ–°ç‰ˆæœ¬
3. **URL è·³è½¬**ï¼šç‚¹å‡»ç‰ˆæœ¬åˆ‡æ¢å™¨æ—¶ï¼Œç›´æ¥è·³è½¬åˆ°å¯¹åº”ç‰ˆæœ¬çš„ URL
4. **SEO å‹å¥½**ï¼šæ¯ä¸ªç‰ˆæœ¬å¯ç‹¬ç«‹åˆ†äº«ï¼Œæ”¯æŒæœç´¢å¼•æ“ç´¢å¼•

### ğŸ¨ è‡ªå®šä¹‰ç•Œé¢

- **é‡å®šå‘é¡µé¢**ï¼šä¿®æ”¹ `scripts/update-version-index.js` ä¸­çš„ä¸»é¡µæ¨¡æ¿
- **ç‰ˆæœ¬åˆ‡æ¢å™¨**ï¼šç¼–è¾‘ `src/version-switcher.js` å’Œ `src/version-switcher.css`
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯ï¼Œå®Œå…¨å…¼å®¹å„ç§æ¡†æ¶

## è¯¦ç»†æ–‡æ¡£

- [å®Œæ•´ä½¿ç”¨æŒ‡å—](docs/usage.md)
- [æµ‹è¯•é¡¹ç›®ç¤ºä¾‹](test/)
- [GitHub Actions å·¥ä½œæµ](.github/workflows/version-archive.yml)

## è®¸å¯è¯

MIT License
