# Version Stage Workflow

ä¸€ä¸ªå¯å¤ç”¨çš„ GitHub Actions å·¥ä½œæµèŠ‚ç‚¹ï¼Œä¸“é—¨ç”¨äº Web é¡¹ç›®çš„ç‰ˆæœ¬åŒ–å½’æ¡£å’Œç‰ˆæœ¬åˆ‡æ¢åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ·ï¸ **å¯å¤ç”¨å·¥ä½œæµ**ï¼šä½œä¸ºä¸‹çº§èŠ‚ç‚¹è¢«å…¶ä»–é¡¹ç›®è°ƒç”¨ï¼Œæ— éœ€å¤„ç†æ„å»ºè¿‡ç¨‹
- ğŸš€ **è‡ªåŠ¨ç‰ˆæœ¬å½’æ¡£**ï¼šå°†å·²æ„å»ºçš„äº§ç‰©æŒ‰ç‰ˆæœ¬å·å½’æ¡£åˆ°æŒ‡å®šåˆ†æ”¯
- ğŸ”„ **ç‰ˆæœ¬åˆ‡æ¢UI**ï¼šç¾è§‚çš„æ‚¬æµ®ç‰ˆæœ¬åˆ‡æ¢å™¨ï¼Œæ”¯æŒæœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸ“¦ **å¤šé¡¹ç›®æ”¯æŒ**ï¼šå¯è¢«ä¸åŒçš„ Web é¡¹ç›®å¤ç”¨
- ğŸ” **æ™ºèƒ½æœç´¢**ï¼šæ”¯æŒç‰ˆæœ¬å·æ¨¡ç³Šæœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸŒ **GitHub Pagesé›†æˆ**ï¼šè‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pagesï¼ŒåŒ…å«ç‰ˆæœ¬æµè§ˆä¸»é¡µ
- ğŸ¨ **æ¨¡æ¿åŒ–è®¾è®¡**ï¼šUIç»„ä»¶ä½¿ç”¨ç‹¬ç«‹æ¨¡æ¿æ–‡ä»¶ï¼Œæ˜“äºç»´æŠ¤å’Œè‡ªå®šä¹‰

## è®¾è®¡ç†å¿µ

æ­¤å·¥ä½œæµä¸“é—¨è®¾è®¡ä¸º **ä¸‹çº§èŠ‚ç‚¹**ï¼Œä¸“æ³¨äºç‰ˆæœ¬å½’æ¡£åŠŸèƒ½ï¼š

- âœ… **æ¥æ”¶æ„å»ºäº§ç‰©**ï¼šä»è°ƒç”¨æ–¹è·å–å·²æ„å»ºçš„æ–‡ä»¶
- âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼šè‡ªåŠ¨æ£€æµ‹æˆ–æ¥æ”¶ç‰ˆæœ¬å·
- âœ… **å½’æ¡£å­˜å‚¨**ï¼šæŒ‰ç‰ˆæœ¬ç»„ç»‡å’Œå­˜å‚¨æ–‡ä»¶
- âœ… **UIæ³¨å…¥**ï¼šè‡ªåŠ¨æ·»åŠ ç‰ˆæœ¬åˆ‡æ¢åŠŸèƒ½
- âŒ **ä¸å¤„ç†æ„å»º**ï¼šä¸æ¶‰åŠä¾èµ–å®‰è£…ã€ç¼–è¯‘ç­‰æ„å»ºè¿‡ç¨‹

## å¿«é€Ÿå¼€å§‹

### 1. åœ¨æ‚¨çš„é¡¹ç›®ä¸­å¼•ç”¨

```yaml
# .github/workflows/deploy.yml
name: Build and Archive

on:
  push:
    tags: ['v*']

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'pnpm'
    
    # æ‚¨çš„æ„å»ºè¿‡ç¨‹
    - run: pnpm install
    - run: pnpm build

  # è°ƒç”¨ç‰ˆæœ¬å½’æ¡£å·¥ä½œæµ
  archive:
    needs: build
    uses: your-username/version-stage-workflow/.github/workflows/version-archive.yml@main
    with:
      build_dir: 'dist'  # æ‚¨çš„æ„å»ºè¾“å‡ºç›®å½•
    secrets:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### 2. æœ¬åœ°å¼€å‘æµ‹è¯•

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/version-stage-workflow.git
cd version-stage-workflow

# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºæµ‹è¯•é¡¹ç›®
cd test && node build.js && cd ..

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
# è®¿é—® http://localhost:3000/test/
```

## ç›®å½•ç»“æ„

```
version-stage-workflow/
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ version-archive.yml     # ä¸»å·¥ä½œæµæ–‡ä»¶
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ archive-version.js      # ç‰ˆæœ¬å½’æ¡£è„šæœ¬
â”‚   â”œâ”€â”€ update-version-index.js # ç‰ˆæœ¬ç´¢å¼•æ›´æ–°è„šæœ¬
â”‚   â”œâ”€â”€ build.js               # æ„å»ºè„šæœ¬
â”‚   â””â”€â”€ dev-server.js          # å¼€å‘æœåŠ¡å™¨
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ version-switcher.js    # ç‰ˆæœ¬åˆ‡æ¢å™¨è„šæœ¬
â”‚   â””â”€â”€ version-switcher.css   # ç‰ˆæœ¬åˆ‡æ¢å™¨æ ·å¼
â”œâ”€â”€ test/                      # æµ‹è¯•é¡¹ç›®
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ usage.md              # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â””â”€â”€ package.json
```

## é…ç½®å‚æ•°

| å‚æ•° | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `build_dir` | âœ… | `dist` | æ„å»ºäº§ç‰©ç›®å½• |
| `version` | âŒ | è‡ªåŠ¨æ£€æµ‹ | ç‰ˆæœ¬å· |
| `archive_branch` | âŒ | `gh-pages` | å½’æ¡£åˆ†æ”¯ |
| `force_archive` | âŒ | `false` | å¼ºåˆ¶è¦†ç›– |
| `enable_pages` | âŒ | `true` | éƒ¨ç½²åˆ° Pages |

## ç‰ˆæœ¬æ£€æµ‹è§„åˆ™

1. æ‰‹åŠ¨è¾“å…¥çš„ `version` å‚æ•°
2. Git æ ‡ç­¾ï¼ˆå¦‚æ¨é€ v1.0.0 æ ‡ç­¾ï¼‰
3. package.json ä¸­çš„ version å­—æ®µ
4. é»˜è®¤å€¼ v1.0.0

## ä½¿ç”¨æ•ˆæœ

å½’æ¡£å®Œæˆåï¼š
- ğŸ“ æ¯ä¸ªç‰ˆæœ¬ç‹¬ç«‹å­˜å‚¨åœ¨ `versions/1.0.0/` ç›®å½•
- ğŸ·ï¸ è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬åˆ‡æ¢å™¨UIï¼ˆå·¦ä¸Šè§’ï¼‰
- ğŸ” æ”¯æŒç‰ˆæœ¬æœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸŒ é€šè¿‡ GitHub Pages åœ¨çº¿è®¿é—®

## æ¨¡æ¿è‡ªå®šä¹‰

### ğŸ“‚ æ¨¡æ¿æ–‡ä»¶ç»“æ„

```
templates/
â”œâ”€â”€ archive-index.html      # ç‰ˆæœ¬å½’æ¡£ä¸»é¡µæ¨¡æ¿
â””â”€â”€ version-switcher.html   # ç‰ˆæœ¬åˆ‡æ¢å™¨æ¨¡æ¿
```

### ğŸ¨ è‡ªå®šä¹‰ç•Œé¢

1. **ä¿®æ”¹å½’æ¡£ä¸»é¡µ**ï¼šç¼–è¾‘ `templates/archive-index.html`
   - æ”¯æŒå˜é‡æ›¿æ¢ï¼š`{{ARCHIVE_DIR}}` ä¼šè¢«æ›¿æ¢ä¸ºå®é™…çš„å½’æ¡£ç›®å½•
   - å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
   - åŒ…å«ç‰ˆæœ¬æœç´¢å’Œç»Ÿè®¡åŠŸèƒ½

2. **è‡ªå®šä¹‰ç‰ˆæœ¬åˆ‡æ¢å™¨**ï¼šç¼–è¾‘ `templates/version-switcher.html`
   - æ‚¬æµ®åœ¨é¡µé¢å·¦ä¸Šè§’
   - æ”¯æŒæœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
   - è‡ªåŠ¨æ³¨å…¥åˆ°æ¯ä¸ªç‰ˆæœ¬é¡µé¢

### ğŸ”§ ç»´æŠ¤ä¼˜åŠ¿

- âœ… **ç‹¬ç«‹æ–‡ä»¶**ï¼šUIä»£ç ä¸å†æ··åœ¨å·¥ä½œæµä¸­
- âœ… **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ¨¡æ¿å˜æ›´æœ‰å®Œæ•´çš„Gitå†å²
- âœ… **æ˜“äºè°ƒè¯•**ï¼šå¯ä»¥åœ¨æœ¬åœ°ç›´æ¥ç¼–è¾‘å’Œé¢„è§ˆ
- âœ… **å›¢é˜Ÿåä½œ**ï¼šè®¾è®¡å¸ˆå¯ä»¥ç›´æ¥ä¿®æ”¹HTML/CSS

## è¯¦ç»†æ–‡æ¡£

- [å®Œæ•´ä½¿ç”¨æŒ‡å—](docs/usage.md)
- [æµ‹è¯•é¡¹ç›®ç¤ºä¾‹](test/)
- [GitHub Actions å·¥ä½œæµ](.github/workflows/version-archive.yml)

## è®¸å¯è¯

MIT License
