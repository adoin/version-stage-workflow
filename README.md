# Version Stage Workflow

ä¸€ä¸ªå¯å¤ç”¨çš„ GitHub Actions å·¥ä½œæµèŠ‚ç‚¹ï¼Œä¸“é—¨ç”¨äº Web é¡¹ç›®çš„ç‰ˆæœ¬åŒ–å½’æ¡£å’Œç‰ˆæœ¬åˆ‡æ¢åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ·ï¸ **å¯å¤ç”¨å·¥ä½œæµ**ï¼šä½œä¸ºä¸‹çº§èŠ‚ç‚¹è¢«å…¶ä»–é¡¹ç›®è°ƒç”¨ï¼Œæ— éœ€å¤„ç†æ„å»ºè¿‡ç¨‹
- ğŸš€ **è‡ªåŠ¨ç‰ˆæœ¬å½’æ¡£**ï¼šå°†å·²æ„å»ºçš„äº§ç‰©æŒ‰ç‰ˆæœ¬å·å½’æ¡£åˆ°æŒ‡å®šåˆ†æ”¯
- ğŸ”„ **ç‰ˆæœ¬åˆ‡æ¢UI**ï¼šç¾è§‚çš„æ‚¬æµ®ç‰ˆæœ¬åˆ‡æ¢å™¨ï¼Œæ”¯æŒæœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸ“¦ **å¤šé¡¹ç›®æ”¯æŒ**ï¼šå¯è¢«ä¸åŒçš„ Web é¡¹ç›®å¤ç”¨
- ğŸ” **æ™ºèƒ½æœç´¢**ï¼šæ”¯æŒç‰ˆæœ¬å·æ¨¡ç³Šæœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸŒ **GitHub Pagesé›†æˆ**ï¼šè‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pagesï¼ŒåŒ…å«ç‰ˆæœ¬æµè§ˆä¸»é¡µ
- ğŸ¨ **æ¨¡æ¿åŒ–è®¾è®¡**ï¼šUIç»„ä»¶ä½¿ç”¨ç‹¬ç«‹æ¨¡æ¿æ–‡ä»¶ï¼Œæ˜“äºç»´æŠ¤å’Œè‡ªå®šä¹‰

## è®¾è®¡ç†å¿µ

æ­¤å·¥ä½œæµä¸“é—¨è®¾è®¡ä¸º **ä¸‹çº§èŠ‚ç‚¹**ï¼Œä¸“æ³¨äºç‰ˆæœ¬å½’æ¡£åŠŸèƒ½ï¼š

- âœ… **æ¥æ”¶æ„å»ºäº§ç‰©**ï¼šä»è°ƒç”¨æ–¹è·å–å·²æ„å»ºçš„æ–‡ä»¶
- âœ… **ç‰ˆæœ¬ç®¡ç†**ï¼šè‡ªåŠ¨æ£€æµ‹æˆ–æ¥æ”¶ç‰ˆæœ¬å·
- âœ… **å½’æ¡£å­˜å‚¨**ï¼šæŒ‰ç‰ˆæœ¬ç»„ç»‡å’Œå­˜å‚¨æ–‡ä»¶
- âœ… **UIæ³¨å…¥**ï¼šè‡ªåŠ¨æ·»åŠ ç‰ˆæœ¬åˆ‡æ¢åŠŸèƒ½
- âŒ **ä¸å¤„ç†æ„å»º**ï¼šä¸æ¶‰åŠä¾èµ–å®‰è£…ã€ç¼–è¯‘ç­‰æ„å»ºè¿‡ç¨‹

## å¿«é€Ÿå¼€å§‹

### 1. åœ¨æ‚¨çš„é¡¹ç›®ä¸­å¼•ç”¨

```yaml
# .github/workflows/deploy.yml
name: Build and Archive

on:
  push:
    tags: ['v*']

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'pnpm'
    
    # æ‚¨çš„æ„å»ºè¿‡ç¨‹
    - run: pnpm install
    - run: pnpm build

  # è°ƒç”¨ç‰ˆæœ¬å½’æ¡£å·¥ä½œæµ
  archive:
    needs: build
    uses: your-username/version-stage-workflow/.github/workflows/version-archive.yml@main
    with:
      build_dir: 'dist'  # æ‚¨çš„æ„å»ºè¾“å‡ºç›®å½•
    secrets:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

### 2. æœ¬åœ°å¼€å‘æµ‹è¯•

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/version-stage-workflow.git
cd version-stage-workflow

# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºæµ‹è¯•é¡¹ç›®
cd test && node build.js && cd ..

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
# è®¿é—® http://localhost:3000/test/
```

## ç›®å½•ç»“æ„

```
version-stage-workflow/
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ version-archive.yml     # ä¸»å·¥ä½œæµæ–‡ä»¶
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ archive-version.js      # ç‰ˆæœ¬å½’æ¡£è„šæœ¬
â”‚   â”œâ”€â”€ update-version-index.js # ç‰ˆæœ¬ç´¢å¼•æ›´æ–°è„šæœ¬
â”‚   â”œâ”€â”€ build.js               # æ„å»ºè„šæœ¬
â”‚   â””â”€â”€ dev-server.js          # å¼€å‘æœåŠ¡å™¨
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ version-switcher.js    # ç‰ˆæœ¬åˆ‡æ¢å™¨è„šæœ¬
â”‚   â””â”€â”€ version-switcher.css   # ç‰ˆæœ¬åˆ‡æ¢å™¨æ ·å¼
â”œâ”€â”€ test/                      # æµ‹è¯•é¡¹ç›®
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ usage.md              # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â””â”€â”€ package.json
```

## é…ç½®å‚æ•°

| å‚æ•° | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `build_dir` | âœ… | `dist` | æ„å»ºäº§ç‰©ç›®å½• |
| `version` | âŒ | è‡ªåŠ¨æ£€æµ‹ | ç‰ˆæœ¬å· |
| `archive_branch` | âŒ | `gh-pages` | å½’æ¡£åˆ†æ”¯ |
| `force_archive` | âŒ | `false` | å¼ºåˆ¶è¦†ç›– |
| `enable_pages` | âŒ | `true` | éƒ¨ç½²åˆ° Pages |

## ç‰ˆæœ¬æ£€æµ‹è§„åˆ™

1. æ‰‹åŠ¨è¾“å…¥çš„ `version` å‚æ•°
2. Git æ ‡ç­¾ï¼ˆå¦‚æ¨é€ v1.0.0 æ ‡ç­¾ï¼‰
3. package.json ä¸­çš„ version å­—æ®µ
4. é»˜è®¤å€¼ v1.0.0

## ä½¿ç”¨æ•ˆæœ

å½’æ¡£å®Œæˆåï¼š
- ğŸ“ æ¯ä¸ªç‰ˆæœ¬ç‹¬ç«‹å­˜å‚¨åœ¨ `versions/1.0.0/` ç›®å½•
- ğŸ·ï¸ è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬åˆ‡æ¢å™¨UIï¼ˆå·¦ä¸Šè§’ï¼‰
- ğŸ” æ”¯æŒç‰ˆæœ¬æœç´¢å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸŒ é€šè¿‡ GitHub Pages åœ¨çº¿è®¿é—®

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ğŸ“‚ æœ€ç»ˆéƒ¨ç½²ç»“æ„

```
GitHub Pages æ ¹ç›®å½•/
â”œâ”€â”€ index.html                    # ä¸»é¡µé¢ï¼ˆåŒ…å« iframe å’Œç‰ˆæœ¬åˆ‡æ¢å™¨ï¼‰
â”œâ”€â”€ version-switcher-iframe.js    # ç‰ˆæœ¬åˆ‡æ¢å™¨è„šæœ¬
â””â”€â”€ versions/
    â”œâ”€â”€ index.json                # ç‰ˆæœ¬ç´¢å¼•æ–‡ä»¶
    â”œâ”€â”€ 1.0.0/
    â”‚   â”œâ”€â”€ index.html            # ç‰ˆæœ¬ 1.0.0 çš„é¡µé¢
    â”‚   â””â”€â”€ ...                   # å…¶ä»–èµ„æº
    â””â”€â”€ 1.0.1/
        â”œâ”€â”€ index.html            # ç‰ˆæœ¬ 1.0.1 çš„é¡µé¢
        â””â”€â”€ ...                   # å…¶ä»–èµ„æº
```

### ğŸ”„ ç‰ˆæœ¬åˆ‡æ¢åŸç†

1. **ä¸»é¡µé¢**ï¼šåŒ…å«ä¸€ä¸ªå…¨å± iframe å’Œå·¦ä¸Šè§’çš„ç‰ˆæœ¬åˆ‡æ¢å™¨
2. **URL ä¸å˜**ï¼šç”¨æˆ·å§‹ç»ˆåœ¨ä¸»é¡µé¢ï¼ŒURL ä¿æŒä¸å˜
3. **iframe åˆ‡æ¢**ï¼šç‚¹å‡»ç‰ˆæœ¬åˆ‡æ¢å™¨æ—¶ï¼Œiframe åŠ è½½å¯¹åº”ç‰ˆæœ¬çš„å†…å®¹
4. **æ— ç¼ä½“éªŒ**ï¼šç‰ˆæœ¬é—´åˆ‡æ¢æ— éœ€é¡µé¢è·³è½¬ï¼Œä½“éªŒæµç•…

### ğŸ¨ è‡ªå®šä¹‰ç•Œé¢

- **ä¸»é¡µé¢æ ·å¼**ï¼šä¿®æ”¹å·¥ä½œæµä¸­çš„ HTML æ¨¡æ¿
- **ç‰ˆæœ¬åˆ‡æ¢å™¨**ï¼šç¼–è¾‘ `src/version-switcher-iframe.js`
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯

## è¯¦ç»†æ–‡æ¡£

- [å®Œæ•´ä½¿ç”¨æŒ‡å—](docs/usage.md)
- [æµ‹è¯•é¡¹ç›®ç¤ºä¾‹](test/)
- [GitHub Actions å·¥ä½œæµ](.github/workflows/version-archive.yml)

## è®¸å¯è¯

MIT License
